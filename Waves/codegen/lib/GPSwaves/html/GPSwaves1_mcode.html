<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T1U3">Hs</span>, <span class="var type1" id="S3T1U4">Tp</span>, <span class="var type1" id="S4T1U5">Dp</span>, <span class="var type1" id="S5T2U6">E</span>, <span class="var type1" id="S6T2U7">f</span>, <span class="var type1" id="S7T2U8">a1</span>, <span class="var type1" id="S8T2U9">b1</span>, <span class="var type1" id="S9T2U10">a2</span>, <span class="var type1" id="S10T2U11">b2</span>] = GPSwaves(<span class="var type1" id="S11T2U14">u</span>,<span class="var type1" id="S12T2U15">v</span>,<span class="var type1" id="S13T2U16">z</span>,<span class="var type1" id="S14T1U17">fs</span>) </span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% matlab function to read and process GPS data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   to estimate wave height, period, direction, and spectral moments</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   assuming deep-water limit of surface gravity wave dispersion relation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% Inputs are east velocity [m/s], north velocity [m/s], vertical </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% elevation relative to MSL [m], and sampling rate [Hz]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">% Some inputs can be empty variables, in which case the algorithm will use</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% whatever non-empty inputs are available, with preference for GPS</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">% velocities</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">% Required input is sampling rate, which must be at least 1 Hz and the same</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% for all variables.  Additionaly, non-empty input time series data must </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">% have at least 512 points and all be the same size.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">% Outputs are significat wave height [m], dominant period [s], dominant direction </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">% [deg T, using meteorological from which waves are propagating], spectral </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">% energy density [m^2/Hz], frequency [Hz], and </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">% the normalized spectral moments a1, b1, a2, b2, </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">% Outputs will be '9999' for invalid results.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">% Outputs can be supressed, in order, thus full usage is as follows:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%   [ Hs, Tp, Dp, E, f, a1, b1, a2, b2 ] = GPSwaves(u,v,z,fs); </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">% and minimal usage is:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%   [ Hs, Tp ] = GPSwaves(u,v,[],[],[],fs); </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">% J. Thomson,  12/2013, v1, modified from PUVspectra.m (2003)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%              10/2015, v2, include vertical GPS estimate to get all four directional moments</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%              10/2017, v3, change the RC filter parameter to 3.5, after</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%                           realizing that the cuttoff period is 2 pi * RC, not RC</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%              11/2018, v4, force velocity spectra as source for scalar energy spectra</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%                           remove LFNR usage</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%                           correct sign of a1, b1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%               8/2019  force use of Tp from velocity spectra, increase max f to 1 Hz</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%               </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%% tunable parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">% low frequency noise ratio tolerance (not applied as of Nov 2018)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line">    <span class="mxinfo " id="T1:U14"><span class="var type1" id="S15T1U20">LFNR</span> = <span class="mxinfo " id="T1:U16">4</span></span> ; </span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">% standard deviations for despiking        </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line">    <span class="mxinfo " id="T1:U17"><span class="var type1" id="S16T1U24">Nstd</span> = <span class="mxinfo " id="T1:U19">10</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">% time constant [s] for high-pass filter </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line">    <span class="mxinfo " id="T1:U20"><span class="var type1" id="S17T1U28">RC</span> = <span class="mxinfo " id="T1:U22">3.5</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">% energy ratios (unused as of Oct 2017)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%maxEratio = 5; % max allowed ratio of Ezz to Exx + Eyy, default is 5</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%minEratio = .1; % min allowed ratio of Ezz to Exx + Eyy, default is 0.1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">%% fixed parameters (which will produce 42 frequency bands)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="mxinfo " id="T1:U23"><span class="var type1" id="S18T1U32">wsecs</span> = <span class="mxinfo " id="T1:U25">256</span></span>;   <span class="comment">% windoz length in seconds, should make 2^N samples</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo " id="T1:U26"><span class="var type1" id="S19T1U36">merge</span> = <span class="mxinfo " id="T1:U28">3</span></span>;      <span class="comment">% freq bands to merge, must be odd?</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="mxinfo " id="T1:U29"><span class="var type1" id="S20T1U40">maxf</span> = <span class="mxinfo " id="T1:U31">.5</span></span>;       <span class="comment">% frequency cutoff for telemetry Hz</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%% deal with variable input data, with priority for GPS velocity</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">% if no vertical, asign a dummy, but then void the a1,a2 result later</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T3:U32">isempty(<span class="var type1" id="S13T2U46">z</span>)</span>,  <span class="comment">% check for accelerations</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line">    <span class="mxinfo " id="T2:U34"><span class="var type1" id="S13T2U49">z</span> = <span class="mxinfo " id="T2:U36">zeros(<span class="mxinfo " id="T1:U37">size(<span class="var type1" id="S11T2U54">u</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line">    <span class="mxinfo " id="T1:U39"><span class="var type1" id="S24T1U57">zdummy</span> = <span class="mxinfo " id="T1:U41">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line">    <span class="mxinfo " id="T2:U42"><span class="var type1" id="S13T2U62">z</span> = <span class="var type1" id="S13T2U63">z</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line">    <span class="mxinfo " id="T1:U45"><span class="var type1" id="S24T1U66">zdummy</span> = <span class="mxinfo " id="T1:U47">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">%% Quality control inputs (despike)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"><span class="mxinfo " id="T4:U48"><span class="var type1" id="S25T4U70">badu</span> = <span class="mxinfo " id="T4:U50"><span class="mxinfo " id="T2:U51">abs(<span class="mxinfo " id="T2:U52">detrend(<span class="var type1" id="S11T2U76">u</span>)</span>)</span> &gt;= <span class="mxinfo " id="T1:U54"><span class="var type1" id="S16T1U78">Nstd</span> * <span class="mxinfo " id="T1:U56">std(<span class="var type1" id="S11T2U81">u</span>)</span></span></span></span>; <span class="comment">% logical array of indices for bad points</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="mxinfo " id="T4:U58"><span class="var type1" id="S29T4U84">badv</span> = <span class="mxinfo " id="T4:U60"><span class="mxinfo " id="T2:U61">abs(<span class="mxinfo " id="T2:U62">detrend(<span class="var type1" id="S12T2U90">v</span>)</span>)</span> &gt;= <span class="mxinfo " id="T1:U64"><span class="var type1" id="S16T1U92">Nstd</span> * <span class="mxinfo " id="T1:U66">std(<span class="var type1" id="S12T2U95">v</span>)</span></span></span></span>; <span class="comment">% logical array of indices for bad points</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line"><span class="mxinfo " id="T4:U68"><span class="var type1" id="S30T4U98">badz</span> = <span class="mxinfo " id="T4:U70"><span class="mxinfo " id="T2:U71">abs(<span class="mxinfo " id="T2:U72">detrend(<span class="var type1" id="S13T2U104">z</span>)</span>)</span> &gt;= <span class="mxinfo " id="T1:U74"><span class="var type1" id="S16T1U106">Nstd</span> * <span class="mxinfo " id="T1:U76">std(<span class="var type1" id="S13T2U109">z</span>)</span></span></span></span>; <span class="comment">% logical array of indices for bad points</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"><span class="mxinfo " id="T2:U78"><span class="mxinfo " id="T2:U79"><span class="var type1" id="S11T2U113">u</span>(<span class="var type1" id="S25T4U114">badu</span>)</span> = <span class="mxinfo " id="T1:U82">mean( <span class="mxinfo " id="T2:U83"><span class="var type1" id="S11T2U118">u</span>(<span class="mxinfo " id="T4:U85">~<span class="var type1" id="S25T4U120">badu</span></span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"><span class="mxinfo " id="T2:U87"><span class="mxinfo " id="T2:U88"><span class="var type1" id="S12T2U124">v</span>(<span class="var type1" id="S29T4U125">badv</span>)</span> = <span class="mxinfo " id="T1:U91">mean( <span class="mxinfo " id="T2:U92"><span class="var type1" id="S12T2U129">v</span>(<span class="mxinfo " id="T4:U94">~<span class="var type1" id="S29T4U131">badv</span></span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"><span class="mxinfo " id="T2:U96"><span class="mxinfo " id="T2:U97"><span class="var type1" id="S13T2U135">z</span>(<span class="var type1" id="S30T4U136">badz</span>)</span> = <span class="mxinfo " id="T1:U100">mean( <span class="mxinfo " id="T2:U101"><span class="var type1" id="S13T2U140">z</span>(<span class="mxinfo " id="T4:U103">~<span class="var type1" id="S30T4U142">badz</span></span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">%% begin processing, if data sufficient</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"><span class="mxinfo " id="T1:U105"><span class="var type1" id="S32T1U145">pts</span> = <span class="mxinfo " id="T1:U107">length(<span class="var type1" id="S11T2U148">u</span>)</span></span>;       <span class="comment">% record length in data points</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T3:U109"><span class="var type1" id="S32T1U155">pts</span> &gt;= <span class="mxinfo " id="T1:U111"><span class="mxinfo " id="T1:U112">2</span>*<span class="var type1" id="S18T1U158">wsecs</span></span></span> &amp; <span class="mxinfo " id="T3:U114"><span class="var type1" id="S14T1U160">fs</span>&gt;=<span class="mxinfo " id="T1:U116">1</span></span> &amp; <span class="mxinfo " id="T3:U117"><span class="mxinfo " id="T1:U118">sum(<span class="var type1" id="S25T4U165">badu</span>)</span>&lt;<span class="mxinfo " id="T1:U120">100</span></span> &amp; <span class="mxinfo " id="T3:U121"><span class="mxinfo " id="T1:U122">sum(<span class="var type1" id="S29T4U170">badv</span>)</span>&lt;<span class="mxinfo " id="T1:U124">100</span></span>,  <span class="comment">% minimum length and quality for processing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">%% high-pass RC filter, detrend first</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line"><span class="mxinfo " id="T2:U125"><span class="var type1" id="S11T2U174">u</span> = <span class="mxinfo " id="T2:U127">detrend(<span class="var type1" id="S11T2U177">u</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line"><span class="mxinfo " id="T2:U129"><span class="var type1" id="S12T2U180">v</span> = <span class="mxinfo " id="T2:U131">detrend(<span class="var type1" id="S12T2U183">v</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="mxinfo " id="T2:U133"><span class="var type1" id="S13T2U186">z</span> = <span class="mxinfo " id="T2:U135">detrend(<span class="var type1" id="S13T2U189">z</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"><span class="comment">%initialize</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="mxinfo " id="T2:U137"><span class="var type1" id="S35T2U192">ufiltered</span> = <span class="var type1" id="S11T2U193">u</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="mxinfo " id="T2:U140"><span class="var type1" id="S36T2U196">vfiltered</span> = <span class="var type1" id="S12T2U197">v</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo " id="T2:U143"><span class="var type1" id="S37T2U200">zfiltered</span> = <span class="var type1" id="S13T2U201">z</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="mxinfo " id="T1:U146"><span class="var type1" id="S38T1U204">alpha</span> = <span class="mxinfo " id="T1:U148"><span class="var type1" id="S17T1U206">RC</span> / (<span class="mxinfo " id="T1:U150"><span class="var type1" id="S17T1U209">RC</span> + <span class="mxinfo " id="T1:U152"><span class="mxinfo " id="T1:U153">1</span>./<span class="var type1" id="S14T1U212">fs</span></span></span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S39T1U215">ui</span> = <span class="mxinfo " id="T1:U156">2</span>:<span class="mxinfo " id="T1:U157">length(<span class="var type1" id="S13T2U220">z</span>)</span>,</span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line">   <span class="mxinfo " id="T1:U159"><span class="mxinfo " id="T1:U160"><span class="var type1" id="S35T2U224">ufiltered</span>(<span class="var type1" id="S39T1U225">ui</span>)</span> = <span class="mxinfo " id="T1:U163"><span class="mxinfo " id="T1:U164"><span class="var type1" id="S38T1U228">alpha</span> * <span class="mxinfo " id="T1:U166"><span class="var type1" id="S35T2U230">ufiltered</span>(<span class="mxinfo " id="T1:U168"><span class="var type1" id="S39T1U232">ui</span>-<span class="mxinfo " id="T1:U170">1</span></span>)</span></span> + <span class="mxinfo " id="T1:U171"><span class="var type1" id="S38T1U235">alpha</span> * ( <span class="mxinfo " id="T1:U173"><span class="mxinfo " id="T1:U174"><span class="var type1" id="S11T2U239">u</span>(<span class="var type1" id="S39T1U240">ui</span>)</span> - <span class="mxinfo " id="T1:U177"><span class="var type1" id="S11T2U242">u</span>(<span class="mxinfo " id="T1:U179"><span class="var type1" id="S39T1U244">ui</span>-<span class="mxinfo " id="T1:U181">1</span></span>)</span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">   <span class="mxinfo " id="T1:U182"><span class="mxinfo " id="T1:U183"><span class="var type1" id="S36T2U249">vfiltered</span>(<span class="var type1" id="S39T1U250">ui</span>)</span> = <span class="mxinfo " id="T1:U186"><span class="mxinfo " id="T1:U187"><span class="var type1" id="S38T1U253">alpha</span> * <span class="mxinfo " id="T1:U189"><span class="var type1" id="S36T2U255">vfiltered</span>(<span class="mxinfo " id="T1:U191"><span class="var type1" id="S39T1U257">ui</span>-<span class="mxinfo " id="T1:U193">1</span></span>)</span></span> + <span class="mxinfo " id="T1:U194"><span class="var type1" id="S38T1U260">alpha</span> * ( <span class="mxinfo " id="T1:U196"><span class="mxinfo " id="T1:U197"><span class="var type1" id="S12T2U264">v</span>(<span class="var type1" id="S39T1U265">ui</span>)</span> - <span class="mxinfo " id="T1:U200"><span class="var type1" id="S12T2U267">v</span>(<span class="mxinfo " id="T1:U202"><span class="var type1" id="S39T1U269">ui</span>-<span class="mxinfo " id="T1:U204">1</span></span>)</span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">   <span class="mxinfo " id="T1:U205"><span class="mxinfo " id="T1:U206"><span class="var type1" id="S37T2U274">zfiltered</span>(<span class="var type1" id="S39T1U275">ui</span>)</span> = <span class="mxinfo " id="T1:U209"><span class="mxinfo " id="T1:U210"><span class="var type1" id="S38T1U278">alpha</span> * <span class="mxinfo " id="T1:U212"><span class="var type1" id="S37T2U280">zfiltered</span>(<span class="mxinfo " id="T1:U214"><span class="var type1" id="S39T1U282">ui</span>-<span class="mxinfo " id="T1:U216">1</span></span>)</span></span> + <span class="mxinfo " id="T1:U217"><span class="var type1" id="S38T1U285">alpha</span> * ( <span class="mxinfo " id="T1:U219"><span class="mxinfo " id="T1:U220"><span class="var type1" id="S13T2U289">z</span>(<span class="var type1" id="S39T1U290">ui</span>)</span> - <span class="mxinfo " id="T1:U223"><span class="var type1" id="S13T2U292">z</span>(<span class="mxinfo " id="T1:U225"><span class="var type1" id="S39T1U294">ui</span>-<span class="mxinfo " id="T1:U227">1</span></span>)</span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line"><span class="mxinfo " id="T2:U228"><span class="var type1" id="S11T2U298">u</span> = <span class="var type1" id="S35T2U299">ufiltered</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line"><span class="mxinfo " id="T2:U231"><span class="var type1" id="S12T2U302">v</span> = <span class="var type1" id="S36T2U303">vfiltered</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line"><span class="mxinfo " id="T2:U234"><span class="var type1" id="S13T2U306">z</span> = <span class="var type1" id="S37T2U307">zfiltered</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line"><span class="comment">%% break into windows (use 75 percent overlap)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line"><span class="mxinfo " id="T1:U237"><span class="var type1" id="S40T1U310">win</span> = <span class="mxinfo " id="T1:U239">round(<span class="mxinfo " id="T1:U240"><span class="var type1" id="S14T1U314">fs</span> * <span class="var type1" id="S18T1U315">wsecs</span></span>)</span></span>; <span class="comment">% windoz length in data points</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T3:U243"><span class="mxinfo " id="T1:U244">rem(<span class="var type1" id="S40T1U321">win</span>,2)</span>~=<span class="mxinfo " id="T1:U246">0</span></span>, <span class="mxinfo " id="T1:U247"><span class="var type1" id="S40T1U326">win</span> = <span class="mxinfo " id="T1:U249"><span class="var type1" id="S40T1U328">win</span>-<span class="mxinfo " id="T1:U251">1</span></span></span>; <span class="keyword">else</span> <span class="keyword">end</span>  <span class="comment">% make z an even number</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line"><span class="mxinfo " id="T1:U252"><span class="var type1" id="S43T1U333">windows</span> = <span class="mxinfo " id="T1:U254">floor( <span class="mxinfo " id="T1:U255"><span class="mxinfo " id="T1:U256"><span class="mxinfo " id="T1:U257">4</span>*(<span class="mxinfo " id="T1:U258"><span class="mxinfo " id="T1:U259"><span class="var type1" id="S32T1U342">pts</span>/<span class="var type1" id="S40T1U343">win</span></span> - <span class="mxinfo " id="T1:U262">1</span></span>)</span>+<span class="mxinfo " id="T1:U263">1</span></span> )</span></span>;   <span class="comment">% number of windows, the 4 comes from a 75% overlap</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line"><span class="mxinfo " id="T1:U264"><span class="var type1" id="S45T1U348">dof</span> = <span class="mxinfo " id="T1:U266"><span class="mxinfo " id="T1:U267"><span class="mxinfo " id="T1:U268">2</span>*<span class="var type1" id="S43T1U352">windows</span></span>*<span class="var type1" id="S19T1U353">merge</span></span></span>; <span class="comment">% degrees of freedom</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line"><span class="comment">% loop to create a matrix of time series, where COLUMN = WINDOz </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line"><span class="mxinfo " id="T5:U271"><span class="var type1" id="S46T5U356">uwindow</span> = <span class="mxinfo " id="T5:U273">zeros(<span class="var type1" id="S40T1U359">win</span>,<span class="var type1" id="S43T1U360">windows</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line"><span class="mxinfo " id="T5:U276"><span class="var type1" id="S47T5U363">vwindow</span> = <span class="mxinfo " id="T5:U278">zeros(<span class="var type1" id="S40T1U366">win</span>,<span class="var type1" id="S43T1U367">windows</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line"><span class="mxinfo " id="T5:U281"><span class="var type1" id="S48T5U370">zwindow</span> = <span class="mxinfo " id="T5:U283">zeros(<span class="var type1" id="S40T1U373">win</span>,<span class="var type1" id="S43T1U374">windows</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S49T1U377">q</span>=<span class="mxinfo " id="T1:U287">1</span>:<span class="var type1" id="S43T1U380">windows</span>, </span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line">	<span class="mxinfo " id="T6:U289"><span class="mxinfo " id="T6:U290"><span class="var type1" id="S46T5U384">uwindow</span>(<span class="mxinfo " id="T7:U292">:</span>,<span class="var type1" id="S49T1U386">q</span>)</span> = <span class="mxinfo " id="T2:U294"><span class="var type1" id="S11T2U388">u</span>(  <span class="mxinfo " id="T6:U296"><span class="mxinfo " id="T1:U297"><span class="mxinfo " id="T1:U298">(<span class="mxinfo " id="T1:U299"><span class="var type1" id="S49T1U394">q</span>-<span class="mxinfo " id="T1:U301">1</span></span>)*(<span class="mxinfo " id="T1:U302"><span class="mxinfo " id="T1:U303">.25</span>*<span class="var type1" id="S40T1U399">win</span></span>)</span>+1</span>  :  <span class="mxinfo " id="T1:U305">(<span class="var type1" id="S49T1U405">q</span>-1)*(.25*<span class="var type1" id="S40T1U410">win</span>)+<span class="var type1" id="S40T1U411">win</span></span></span>  )</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line">	<span class="mxinfo " id="T6:U309"><span class="mxinfo " id="T6:U310"><span class="var type1" id="S47T5U415">vwindow</span>(<span class="mxinfo " id="T7:U312">:</span>,<span class="var type1" id="S49T1U417">q</span>)</span> = <span class="mxinfo " id="T2:U314"><span class="var type1" id="S12T2U419">v</span>(  <span class="mxinfo " id="T6:U316"><span class="mxinfo " id="T1:U317"><span class="mxinfo " id="T1:U318">(<span class="mxinfo " id="T1:U319"><span class="var type1" id="S49T1U425">q</span>-<span class="mxinfo " id="T1:U321">1</span></span>)*(<span class="mxinfo " id="T1:U322"><span class="mxinfo " id="T1:U323">.25</span>*<span class="var type1" id="S40T1U430">win</span></span>)</span>+1</span>  :  <span class="mxinfo " id="T1:U325">(<span class="var type1" id="S49T1U436">q</span>-1)*(.25*<span class="var type1" id="S40T1U441">win</span>)+<span class="var type1" id="S40T1U442">win</span></span></span>  )</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">  	<span class="mxinfo " id="T6:U329"><span class="mxinfo " id="T6:U330"><span class="var type1" id="S48T5U446">zwindow</span>(<span class="mxinfo " id="T7:U332">:</span>,<span class="var type1" id="S49T1U448">q</span>)</span> = <span class="mxinfo " id="T2:U334"><span class="var type1" id="S13T2U450">z</span>(  <span class="mxinfo " id="T6:U336"><span class="mxinfo " id="T1:U337"><span class="mxinfo " id="T1:U338">(<span class="mxinfo " id="T1:U339"><span class="var type1" id="S49T1U456">q</span>-<span class="mxinfo " id="T1:U341">1</span></span>)*(<span class="mxinfo " id="T1:U342"><span class="mxinfo " id="T1:U343">.25</span>*<span class="var type1" id="S40T1U461">win</span></span>)</span>+1</span>  :  <span class="mxinfo " id="T1:U345">(<span class="var type1" id="S49T1U467">q</span>-1)*(.25*<span class="var type1" id="S40T1U472">win</span>)+<span class="var type1" id="S40T1U473">win</span></span></span>  )</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line"><span class="comment">%% detrend individual windows (full series already detrended)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S49T1U476">q</span>=<span class="mxinfo " id="T1:U350">1</span>:<span class="var type1" id="S43T1U479">windows</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line"><span class="mxinfo " id="T6:U352"><span class="mxinfo " id="T6:U353"><span class="var type1" id="S46T5U483">uwindow</span>(<span class="mxinfo " id="T7:U355">:</span>,<span class="var type1" id="S49T1U485">q</span>)</span> = <span class="mxinfo " id="T6:U357">detrend(<span class="mxinfo " id="T6:U358"><span class="var type1" id="S46T5U489">uwindow</span>(<span class="mxinfo " id="T7:U360">:</span>,<span class="var type1" id="S49T1U491">q</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line"><span class="mxinfo " id="T6:U362"><span class="mxinfo " id="T6:U363"><span class="var type1" id="S47T5U495">vwindow</span>(<span class="mxinfo " id="T7:U365">:</span>,<span class="var type1" id="S49T1U497">q</span>)</span> = <span class="mxinfo " id="T6:U367">detrend(<span class="mxinfo " id="T6:U368"><span class="var type1" id="S47T5U501">vwindow</span>(<span class="mxinfo " id="T7:U370">:</span>,<span class="var type1" id="S49T1U503">q</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line"><span class="mxinfo " id="T6:U372"><span class="mxinfo " id="T6:U373"><span class="var type1" id="S48T5U507">zwindow</span>(<span class="mxinfo " id="T7:U375">:</span>,<span class="var type1" id="S49T1U509">q</span>)</span> = <span class="mxinfo " id="T6:U377">detrend(<span class="mxinfo " id="T6:U378"><span class="var type1" id="S48T5U513">zwindow</span>(<span class="mxinfo " id="T7:U380">:</span>,<span class="var type1" id="S49T1U515">q</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line"><span class="comment">%% taper and rescale (to preserve variance)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line"><span class="comment">% form taper matrix (columns of taper coef)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line"><span class="mxinfo " id="T5:U382"><span class="var type1" id="S50T5U518">taper</span> = <span class="mxinfo " id="T5:U384"><span class="mxinfo " id="T6:U385"><span class="mxinfo " id="T2:U386">sin ( <span class="mxinfo " id="T2:U387"><span class="mxinfo " id="T2:U388">(<span class="mxinfo " id="T2:U389">1:<span class="var type1" id="S40T1U528">win</span></span>) * <span class="mxinfo " id="T1:U391">pi</span></span>/<span class="var type1" id="S40T1U531">win</span></span> )</span>'</span> * <span class="mxinfo " id="T8:U393">ones(<span class="mxinfo " id="T1:U394">1</span>,<span class="var type1" id="S43T1U535">windows</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line"><span class="comment">% taper each window</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line"><span class="mxinfo " id="T5:U396"><span class="var type1" id="S54T5U538">uwindowtaper</span> = <span class="mxinfo " id="T5:U398"><span class="var type1" id="S46T5U540">uwindow</span> .* <span class="var type1" id="S50T5U541">taper</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line"><span class="mxinfo " id="T5:U401"><span class="var type1" id="S55T5U544">vwindowtaper</span> = <span class="mxinfo " id="T5:U403"><span class="var type1" id="S47T5U546">vwindow</span> .* <span class="var type1" id="S50T5U547">taper</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line"><span class="mxinfo " id="T5:U406"><span class="var type1" id="S56T5U550">zwindowtaper</span> = <span class="mxinfo " id="T5:U408"><span class="var type1" id="S48T5U552">zwindow</span> .* <span class="var type1" id="S50T5U553">taper</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line"><span class="comment">% noz find the correction factor (comparing old/nez variance)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line"><span class="mxinfo " id="T8:U411"><span class="var type1" id="S57T8U556">factu</span> = <span class="mxinfo " id="T2:U413">sqrt( <span class="mxinfo " id="T2:U414"><span class="mxinfo " id="T8:U415">var(<span class="var type1" id="S46T5U562">uwindow</span>)</span> ./ <span class="mxinfo " id="T8:U417">var(<span class="var type1" id="S54T5U565">uwindowtaper</span>)</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line"><span class="mxinfo " id="T8:U419"><span class="var type1" id="S60T8U568">factv</span> = <span class="mxinfo " id="T2:U421">sqrt( <span class="mxinfo " id="T2:U422"><span class="mxinfo " id="T8:U423">var(<span class="var type1" id="S47T5U574">vwindow</span>)</span> ./ <span class="mxinfo " id="T8:U425">var(<span class="var type1" id="S55T5U577">vwindowtaper</span>)</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line"><span class="mxinfo " id="T8:U427"><span class="var type1" id="S61T8U580">factz</span> = <span class="mxinfo " id="T2:U429">sqrt( <span class="mxinfo " id="T2:U430"><span class="mxinfo " id="T8:U431">var(<span class="var type1" id="S48T5U586">zwindow</span>)</span> ./ <span class="mxinfo " id="T8:U433">var(<span class="var type1" id="S56T5U589">zwindowtaper</span>)</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line"><span class="comment">% and correct for the change in variance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line"><span class="comment">% (mult each windoz by it's variance ratio factor)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line"><span class="mxinfo " id="T5:U435"><span class="var type1" id="S62T5U592">uwindowready</span> = <span class="mxinfo " id="T5:U437">(<span class="mxinfo " id="T5:U438"><span class="mxinfo " id="T6:U439">ones(<span class="var type1" id="S40T1U598">win</span>,1)</span>*<span class="var type1" id="S57T8U600">factu</span></span>).* <span class="var type1" id="S54T5U601">uwindowtaper</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line"><span class="mxinfo " id="T5:U443"><span class="var type1" id="S63T5U604">vwindowready</span> = <span class="mxinfo " id="T5:U445">(<span class="mxinfo " id="T5:U446"><span class="mxinfo " id="T6:U447">ones(<span class="var type1" id="S40T1U610">win</span>,1)</span>*<span class="var type1" id="S60T8U612">factv</span></span>).* <span class="var type1" id="S55T5U613">vwindowtaper</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line"><span class="mxinfo " id="T5:U451"><span class="var type1" id="S64T5U616">zwindowready</span> = <span class="mxinfo " id="T5:U453">(<span class="mxinfo " id="T5:U454"><span class="mxinfo " id="T6:U455">ones(<span class="var type1" id="S40T1U622">win</span>,1)</span>*<span class="var type1" id="S61T8U624">factz</span></span>).* <span class="var type1" id="S56T5U625">zwindowtaper</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line"><span class="comment">%% FFT</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line"><span class="comment">% calculate Fourier coefs</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line"><span class="mxinfo " id="T9:U459"><span class="var type1" id="S65T9U628">Uwindow</span> = <span class="mxinfo " id="T9:U461">fft(<span class="var type1" id="S62T5U631">uwindowready</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line"><span class="mxinfo " id="T9:U463"><span class="var type1" id="S67T9U634">Vwindow</span> = <span class="mxinfo " id="T9:U465">fft(<span class="var type1" id="S63T5U637">vwindowready</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line"><span class="mxinfo " id="T9:U467"><span class="var type1" id="S68T9U640">Zwindow</span> = <span class="mxinfo " id="T9:U469">fft(<span class="var type1" id="S64T5U643">zwindowready</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line"><span class="comment">% second half of fft is redundant, so throz it out</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line"><span class="mxinfo " id="T9:U471"><span class="var type1" id="S65T9U647">Uwindow</span>( <span class="mxinfo " id="T2:U473">(<span class="mxinfo " id="T1:U474"><span class="mxinfo " id="T1:U475"><span class="var type1" id="S40T1U652">win</span>/<span class="mxinfo " id="T1:U477">2</span></span>+<span class="mxinfo " id="T1:U478">1</span></span>):<span class="var type1" id="S40T1U655">win</span></span>, : ) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line"><span class="mxinfo " id="T9:U480"><span class="var type1" id="S67T9U662">Vwindow</span>( <span class="mxinfo " id="T2:U482">(<span class="mxinfo " id="T1:U483"><span class="mxinfo " id="T1:U484"><span class="var type1" id="S40T1U667">win</span>/<span class="mxinfo " id="T1:U486">2</span></span>+<span class="mxinfo " id="T1:U487">1</span></span>):<span class="var type1" id="S40T1U670">win</span></span>, : ) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line"><span class="mxinfo " id="T9:U489"><span class="var type1" id="S68T9U677">Zwindow</span>( <span class="mxinfo " id="T2:U491">(<span class="mxinfo " id="T1:U492"><span class="mxinfo " id="T1:U493"><span class="var type1" id="S40T1U682">win</span>/<span class="mxinfo " id="T1:U495">2</span></span>+<span class="mxinfo " id="T1:U496">1</span></span>):<span class="var type1" id="S40T1U685">win</span></span>, : ) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line"><span class="comment">% throz out the mean (first coef) and add a zero (to make it the right length)  </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line"><span class="mxinfo " id="T9:U498"><span class="var type1" id="S65T9U692">Uwindow</span>(1,:)=[]</span>; <span class="mxinfo " id="T9:U500"><span class="var type1" id="S67T9U700">Vwindow</span>(1,:)=[]</span>; <span class="mxinfo " id="T9:U502"><span class="var type1" id="S68T9U708">Zwindow</span>(1,:)=[]</span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line"><span class="mxinfo " id="T10:U504"><span class="mxinfo " id="T10:U505"><span class="var type1" id="S65T9U716">Uwindow</span>(<span class="mxinfo " id="T1:U507"><span class="var type1" id="S40T1U718">win</span>/<span class="mxinfo " id="T1:U509">2</span></span>,<span class="mxinfo " id="T11:U510">:</span>)</span>=<span class="mxinfo " id="T1:U511">0</span></span>; <span class="mxinfo " id="T10:U512"><span class="mxinfo " id="T10:U513"><span class="var type1" id="S67T9U725">Vwindow</span>(<span class="mxinfo " id="T1:U515"><span class="var type1" id="S40T1U727">win</span>/<span class="mxinfo " id="T1:U517">2</span></span>,<span class="mxinfo " id="T11:U518">:</span>)</span>=<span class="mxinfo " id="T1:U519">0</span></span>; <span class="mxinfo " id="T10:U520"><span class="mxinfo " id="T10:U521"><span class="var type1" id="S68T9U734">Zwindow</span>(<span class="mxinfo " id="T1:U523"><span class="var type1" id="S40T1U736">win</span>/<span class="mxinfo " id="T1:U525">2</span></span>,<span class="mxinfo " id="T11:U526">:</span>)</span>=<span class="mxinfo " id="T1:U527">0</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line"><span class="comment">% POWER SPECTRA (auto-spectra)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line"><span class="mxinfo " id="T12:U528"><span class="var type1" id="S69T12U742">UUwindow</span> = <span class="mxinfo " id="T12:U530">real ( <span class="mxinfo " id="T13:U531"><span class="var type1" id="S65T9U746">Uwindow</span> .* conj(<span class="var type1" id="S65T9U749">Uwindow</span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line"><span class="mxinfo " id="T12:U534"><span class="var type1" id="S72T12U752">VVwindow</span> = <span class="mxinfo " id="T12:U536">real ( <span class="mxinfo " id="T13:U537"><span class="var type1" id="S67T9U756">Vwindow</span> .* conj(<span class="var type1" id="S67T9U759">Vwindow</span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line"><span class="mxinfo " id="T12:U540"><span class="var type1" id="S73T12U762">ZZwindow</span> = <span class="mxinfo " id="T12:U542">real ( <span class="mxinfo " id="T13:U543"><span class="var type1" id="S68T9U766">Zwindow</span> .* conj(<span class="var type1" id="S68T9U769">Zwindow</span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line"><span class="comment">% CROSS-SPECTRA </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line"><span class="mxinfo " id="T13:U546"><span class="var type1" id="S74T13U772">UVwindow</span> = ( <span class="mxinfo " id="T13:U548"><span class="var type1" id="S65T9U775">Uwindow</span> .* conj(<span class="var type1" id="S67T9U778">Vwindow</span>)</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line"><span class="mxinfo " id="T13:U551"><span class="var type1" id="S75T13U781">UZwindow</span> = ( <span class="mxinfo " id="T13:U553"><span class="var type1" id="S65T9U784">Uwindow</span> .* conj(<span class="var type1" id="S68T9U787">Zwindow</span>)</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line"><span class="mxinfo " id="T13:U556"><span class="var type1" id="S76T13U790">VZwindow</span> = ( <span class="mxinfo " id="T13:U558"><span class="var type1" id="S67T9U793">Vwindow</span> .* conj(<span class="var type1" id="S68T9U796">Zwindow</span>)</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line"><span class="comment">%% merge neighboring freq bands (number of bands to merge is a fixed parameter)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line"><span class="comment">% initialize</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line"><span class="mxinfo " id="T5:U561"><span class="var type1" id="S77T5U799">UUwindowmerged</span> = <span class="mxinfo " id="T5:U563">zeros(<span class="mxinfo " id="T1:U564">floor(<span class="mxinfo " id="T1:U565"><span class="var type1" id="S40T1U805">win</span>/(<span class="mxinfo " id="T1:U567">2*<span class="var type1" id="S19T1U809">merge</span></span>)</span>)</span>,<span class="var type1" id="S43T1U810">windows</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line"><span class="mxinfo " id="T5:U570"><span class="var type1" id="S78T5U813">VVwindowmerged</span> = <span class="mxinfo " id="T5:U572">zeros(<span class="mxinfo " id="T1:U573">floor(<span class="mxinfo " id="T1:U574"><span class="var type1" id="S40T1U819">win</span>/(<span class="mxinfo " id="T1:U576">2*<span class="var type1" id="S19T1U823">merge</span></span>)</span>)</span>,<span class="var type1" id="S43T1U824">windows</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line"><span class="mxinfo " id="T5:U579"><span class="var type1" id="S79T5U827">ZZwindowmerged</span> = <span class="mxinfo " id="T5:U581">zeros(<span class="mxinfo " id="T1:U582">floor(<span class="mxinfo " id="T1:U583"><span class="var type1" id="S40T1U833">win</span>/(<span class="mxinfo " id="T1:U585">2*<span class="var type1" id="S19T1U837">merge</span></span>)</span>)</span>,<span class="var type1" id="S43T1U838">windows</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line"><span class="mxinfo " id="T9:U588"><span class="var type1" id="S80T9U841">UVwindowmerged</span> = <span class="mxinfo " id="T9:U590"><span class="mxinfo " id="T14:U591">1i</span>*<span class="mxinfo " id="T5:U592">ones(<span class="mxinfo " id="T1:U593">floor(<span class="mxinfo " id="T1:U594"><span class="var type1" id="S40T1U849">win</span>/(<span class="mxinfo " id="T1:U596">2*<span class="var type1" id="S19T1U853">merge</span></span>)</span>)</span>,<span class="var type1" id="S43T1U854">windows</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line"><span class="mxinfo " id="T9:U599"><span class="var type1" id="S81T9U857">UZwindowmerged</span> = <span class="mxinfo " id="T9:U601"><span class="mxinfo " id="T14:U602">1i</span>*<span class="mxinfo " id="T5:U603">ones(<span class="mxinfo " id="T1:U604">floor(<span class="mxinfo " id="T1:U605"><span class="var type1" id="S40T1U865">win</span>/(<span class="mxinfo " id="T1:U607">2*<span class="var type1" id="S19T1U869">merge</span></span>)</span>)</span>,<span class="var type1" id="S43T1U870">windows</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line"><span class="mxinfo " id="T9:U610"><span class="var type1" id="S82T9U873">VZwindowmerged</span> = <span class="mxinfo " id="T9:U612"><span class="mxinfo " id="T14:U613">1i</span>*<span class="mxinfo " id="T5:U614">ones(<span class="mxinfo " id="T1:U615">floor(<span class="mxinfo " id="T1:U616"><span class="var type1" id="S40T1U881">win</span>/(<span class="mxinfo " id="T1:U618">2*<span class="var type1" id="S19T1U885">merge</span></span>)</span>)</span>,<span class="var type1" id="S43T1U886">windows</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S83T1U889">mi</span> = <span class="var type1" id="S19T1U892">merge</span>:<span class="var type1" id="S19T1U893">merge</span>:(<span class="mxinfo " id="T1:U624"><span class="var type1" id="S40T1U896">win</span>/<span class="mxinfo " id="T1:U626">2</span></span>) </span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line">	<span class="mxinfo " id="T8:U627"><span class="mxinfo " id="T8:U628"><span class="var type1" id="S77T5U901">UUwindowmerged</span>(<span class="mxinfo " id="T1:U630"><span class="var type1" id="S83T1U903">mi</span>/<span class="var type1" id="S19T1U904">merge</span></span>,<span class="mxinfo " id="T11:U633">:</span>)</span> = <span class="mxinfo " id="T2:U634">mean( <span class="mxinfo " id="T12:U635"><span class="var type1" id="S69T12U909">UUwindow</span>(<span class="mxinfo " id="T2:U637">(<span class="mxinfo " id="T1:U638"><span class="mxinfo " id="T1:U639"><span class="var type1" id="S83T1U914">mi</span>-<span class="var type1" id="S19T1U915">merge</span></span>+<span class="mxinfo " id="T1:U642">1</span></span>):<span class="var type1" id="S83T1U917">mi</span></span> , <span class="mxinfo " id="T11:U644">:</span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line">	<span class="mxinfo " id="T8:U645"><span class="mxinfo " id="T8:U646"><span class="var type1" id="S78T5U922">VVwindowmerged</span>(<span class="mxinfo " id="T1:U648"><span class="var type1" id="S83T1U924">mi</span>/<span class="var type1" id="S19T1U925">merge</span></span>,<span class="mxinfo " id="T11:U651">:</span>)</span> = <span class="mxinfo " id="T2:U652">mean( <span class="mxinfo " id="T12:U653"><span class="var type1" id="S72T12U930">VVwindow</span>(<span class="mxinfo " id="T2:U655">(<span class="mxinfo " id="T1:U656"><span class="mxinfo " id="T1:U657"><span class="var type1" id="S83T1U935">mi</span>-<span class="var type1" id="S19T1U936">merge</span></span>+<span class="mxinfo " id="T1:U660">1</span></span>):<span class="var type1" id="S83T1U938">mi</span></span> , <span class="mxinfo " id="T11:U662">:</span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line">   	<span class="mxinfo " id="T8:U663"><span class="mxinfo " id="T8:U664"><span class="var type1" id="S79T5U943">ZZwindowmerged</span>(<span class="mxinfo " id="T1:U666"><span class="var type1" id="S83T1U945">mi</span>/<span class="var type1" id="S19T1U946">merge</span></span>,<span class="mxinfo " id="T11:U669">:</span>)</span> = <span class="mxinfo " id="T2:U670">mean( <span class="mxinfo " id="T12:U671"><span class="var type1" id="S73T12U951">ZZwindow</span>(<span class="mxinfo " id="T2:U673">(<span class="mxinfo " id="T1:U674"><span class="mxinfo " id="T1:U675"><span class="var type1" id="S83T1U956">mi</span>-<span class="var type1" id="S19T1U957">merge</span></span>+<span class="mxinfo " id="T1:U678">1</span></span>):<span class="var type1" id="S83T1U959">mi</span></span> , <span class="mxinfo " id="T11:U680">:</span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line">	<span class="mxinfo " id="T10:U681"><span class="mxinfo " id="T10:U682"><span class="var type1" id="S80T9U964">UVwindowmerged</span>(<span class="mxinfo " id="T1:U684"><span class="var type1" id="S83T1U966">mi</span>/<span class="var type1" id="S19T1U967">merge</span></span>,<span class="mxinfo " id="T11:U687">:</span>)</span> = <span class="mxinfo " id="T15:U688">mean( <span class="mxinfo " id="T13:U689"><span class="var type1" id="S74T13U972">UVwindow</span>(<span class="mxinfo " id="T2:U691">(<span class="mxinfo " id="T1:U692"><span class="mxinfo " id="T1:U693"><span class="var type1" id="S83T1U977">mi</span>-<span class="var type1" id="S19T1U978">merge</span></span>+<span class="mxinfo " id="T1:U696">1</span></span>):<span class="var type1" id="S83T1U980">mi</span></span> , <span class="mxinfo " id="T11:U698">:</span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line">  	<span class="mxinfo " id="T10:U699"><span class="mxinfo " id="T10:U700"><span class="var type1" id="S81T9U985">UZwindowmerged</span>(<span class="mxinfo " id="T1:U702"><span class="var type1" id="S83T1U987">mi</span>/<span class="var type1" id="S19T1U988">merge</span></span>,<span class="mxinfo " id="T11:U705">:</span>)</span> = <span class="mxinfo " id="T15:U706">mean( <span class="mxinfo " id="T13:U707"><span class="var type1" id="S75T13U993">UZwindow</span>(<span class="mxinfo " id="T2:U709">(<span class="mxinfo " id="T1:U710"><span class="mxinfo " id="T1:U711"><span class="var type1" id="S83T1U998">mi</span>-<span class="var type1" id="S19T1U999">merge</span></span>+<span class="mxinfo " id="T1:U714">1</span></span>):<span class="var type1" id="S83T1U1001">mi</span></span> , <span class="mxinfo " id="T11:U716">:</span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line">	<span class="mxinfo " id="T10:U717"><span class="mxinfo " id="T10:U718"><span class="var type1" id="S82T9U1006">VZwindowmerged</span>(<span class="mxinfo " id="T1:U720"><span class="var type1" id="S83T1U1008">mi</span>/<span class="var type1" id="S19T1U1009">merge</span></span>,<span class="mxinfo " id="T11:U723">:</span>)</span> = <span class="mxinfo " id="T15:U724">mean( <span class="mxinfo " id="T13:U725"><span class="var type1" id="S76T13U1014">VZwindow</span>(<span class="mxinfo " id="T2:U727">(<span class="mxinfo " id="T1:U728"><span class="mxinfo " id="T1:U729"><span class="var type1" id="S83T1U1019">mi</span>-<span class="var type1" id="S19T1U1020">merge</span></span>+<span class="mxinfo " id="T1:U732">1</span></span>):<span class="var type1" id="S83T1U1022">mi</span></span> , <span class="mxinfo " id="T11:U734">:</span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line"><span class="comment">% freq range and bandwidth</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line"><span class="mxinfo " id="T1:U735"><span class="var type1" id="S84T1U1026">n</span> = <span class="mxinfo " id="T1:U737">(<span class="mxinfo " id="T1:U738"><span class="var type1" id="S40T1U1030">win</span>/<span class="mxinfo " id="T1:U740">2</span></span>) / <span class="var type1" id="S19T1U1032">merge</span></span></span>;                         <span class="comment">% number of f bands</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line"><span class="mxinfo " id="T1:U742"><span class="var type1" id="S85T1U1035">Nyquist</span> = <span class="mxinfo " id="T1:U744"><span class="mxinfo " id="T1:U745">.5</span> * <span class="var type1" id="S14T1U1038">fs</span></span></span>;                <span class="comment">% highest spectral frequency </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line"><span class="mxinfo " id="T1:U747"><span class="var type1" id="S86T1U1041">bandwidth</span> = <span class="mxinfo " id="T1:U749"><span class="var type1" id="S85T1U1043">Nyquist</span>/<span class="var type1" id="S84T1U1044">n</span></span></span> ;                    <span class="comment">% freq (Hz) bandwitdh</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line"><span class="comment">% find middle of each freq band, ONLY WORKS WHEN MERGING ODD NUMBER OF BANDS!</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line"><span class="mxinfo " id="T2:U752"><span class="var type1" id="S6T2U1047">f</span> = <span class="mxinfo " id="T2:U754"><span class="mxinfo " id="T1:U755"><span class="mxinfo " id="T1:U756"><span class="mxinfo " id="T1:U757">1</span>/(<span class="var type1" id="S18T1U1053">wsecs</span>)</span> + <span class="mxinfo " id="T1:U759"><span class="var type1" id="S86T1U1055">bandwidth</span>/<span class="mxinfo " id="T1:U761">2</span></span></span> + <span class="mxinfo " id="T2:U762"><span class="var type1" id="S86T1U1058">bandwidth</span>.*(<span class="mxinfo " id="T2:U764">0:(<span class="mxinfo " id="T1:U765"><span class="var type1" id="S84T1U1064">n</span>-<span class="mxinfo " id="T1:U767">1</span></span>)</span>)</span></span></span> ; </span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line"><span class="comment">%% ensemble average windows together</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line"><span class="comment">% take the average of all windows at each freq-band</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line"><span class="comment">% and divide by N*samplerate to get power spectral density</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line"><span class="comment">% the two is b/c Matlab's fft output is the symmetric FFT, </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line"><span class="comment">% and we did not use the redundant half (so need to multiply the psd by 2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line"><span class="mxinfo " id="T2:U768"><span class="var type1" id="S87T2U1068">UU</span> = <span class="mxinfo " id="T2:U770"><span class="mxinfo " id="T2:U771">mean( <span class="mxinfo " id="T16:U772"><span class="var type1" id="S77T5U1073">UUwindowmerged</span>.'</span> )</span> / (<span class="mxinfo " id="T1:U774"><span class="mxinfo " id="T1:U775"><span class="var type1" id="S40T1U1077">win</span>/<span class="mxinfo " id="T1:U777">2</span></span> * <span class="var type1" id="S14T1U1079">fs</span></span>  )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line"><span class="mxinfo " id="T2:U779"><span class="var type1" id="S88T2U1082">VV</span> = <span class="mxinfo " id="T2:U781"><span class="mxinfo " id="T2:U782">mean( <span class="mxinfo " id="T16:U783"><span class="var type1" id="S78T5U1087">VVwindowmerged</span>.'</span> )</span> / (<span class="mxinfo " id="T1:U785"><span class="mxinfo " id="T1:U786"><span class="var type1" id="S40T1U1091">win</span>/<span class="mxinfo " id="T1:U788">2</span></span> * <span class="var type1" id="S14T1U1093">fs</span></span>  )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line"><span class="mxinfo " id="T2:U790"><span class="var type1" id="S89T2U1096">ZZ</span> = <span class="mxinfo " id="T2:U792"><span class="mxinfo " id="T2:U793">mean( <span class="mxinfo " id="T16:U794"><span class="var type1" id="S79T5U1101">ZZwindowmerged</span>.'</span> )</span> / (<span class="mxinfo " id="T1:U796"><span class="mxinfo " id="T1:U797"><span class="var type1" id="S40T1U1105">win</span>/<span class="mxinfo " id="T1:U799">2</span></span> * <span class="var type1" id="S14T1U1107">fs</span></span>  )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line"><span class="mxinfo " id="T15:U801"><span class="var type1" id="S90T15U1110">UV</span> = <span class="mxinfo " id="T15:U803"><span class="mxinfo " id="T15:U804">mean( <span class="mxinfo " id="T17:U805"><span class="var type1" id="S80T9U1115">UVwindowmerged</span>.'</span> )</span> / (<span class="mxinfo " id="T1:U807"><span class="mxinfo " id="T1:U808"><span class="var type1" id="S40T1U1119">win</span>/<span class="mxinfo " id="T1:U810">2</span></span> * <span class="var type1" id="S14T1U1121">fs</span></span>  )</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line"><span class="mxinfo " id="T15:U812"><span class="var type1" id="S91T15U1124">UZ</span> = <span class="mxinfo " id="T15:U814"><span class="mxinfo " id="T15:U815">mean( <span class="mxinfo " id="T17:U816"><span class="var type1" id="S81T9U1129">UZwindowmerged</span>.'</span> )</span> / (<span class="mxinfo " id="T1:U818"><span class="mxinfo " id="T1:U819"><span class="var type1" id="S40T1U1133">win</span>/<span class="mxinfo " id="T1:U821">2</span></span> * <span class="var type1" id="S14T1U1135">fs</span></span>  )</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line"><span class="mxinfo " id="T15:U823"><span class="var type1" id="S92T15U1138">VZ</span> = <span class="mxinfo " id="T15:U825"><span class="mxinfo " id="T15:U826">mean( <span class="mxinfo " id="T17:U827"><span class="var type1" id="S82T9U1143">VZwindowmerged</span>.'</span> )</span> / (<span class="mxinfo " id="T1:U829"><span class="mxinfo " id="T1:U830"><span class="var type1" id="S40T1U1147">win</span>/<span class="mxinfo " id="T1:U832">2</span></span> * <span class="var type1" id="S14T1U1149">fs</span></span>  )</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line"><span class="comment">%% convert to displacement spectra (from velocity and heave)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line"><span class="comment">% assumes perfectly circular deepwater orbits</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line"><span class="comment">% could be extended to finite depth by calling wavenumber.m </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line"><span class="mxinfo " id="T2:U834"><span class="var type1" id="S93T2U1152">Exx</span> = <span class="mxinfo " id="T2:U836">( <span class="var type1" id="S87T2U1155">UU</span> )  ./ ( <span class="mxinfo " id="T2:U838">(<span class="mxinfo " id="T2:U839"><span class="mxinfo " id="T1:U840">2*pi</span>*<span class="var type1" id="S6T2U1164">f</span></span>).^2</span> )</span></span>;  <span class="comment">%[m^2/Hz]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line"><span class="mxinfo " id="T2:U842"><span class="var type1" id="S94T2U1168">Eyy</span> = <span class="mxinfo " id="T2:U844">( <span class="var type1" id="S88T2U1171">VV</span> )  ./ ( <span class="mxinfo " id="T2:U846">(<span class="mxinfo " id="T2:U847"><span class="mxinfo " id="T1:U848">2*pi</span>*<span class="var type1" id="S6T2U1180">f</span></span>).^2</span> )</span></span>;  <span class="comment">%[m^2/Hz]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line"><span class="mxinfo " id="T2:U850"><span class="var type1" id="S95T2U1184">Ezz</span> = ( <span class="var type1" id="S89T2U1186">ZZ</span> )</span> ; <span class="comment">%[m^2/Hz]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,226" id="srcline226">226</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,227" id="srcline227">227</a></span><span class="line"><span class="comment">% use orbit shape as check on quality, expect this to be &lt; 1, b/c SWIFT wobbles</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,228" id="srcline228">228</a></span><span class="line"><span class="mxinfo " id="T2:U853"><span class="var type1" id="S96T2U1189">check</span> = <span class="mxinfo " id="T2:U855"><span class="var type1" id="S95T2U1191">Ezz</span> ./ (<span class="mxinfo " id="T2:U857"><span class="var type1" id="S94T2U1194">Eyy</span> + <span class="var type1" id="S93T2U1195">Exx</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,229" id="srcline229">229</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,230" id="srcline230">230</a></span><span class="line"><span class="mxinfo " id="T2:U860"><span class="var type1" id="S97T2U1198">Qxz</span> = <span class="mxinfo " id="T2:U862"><span class="mxinfo " id="T2:U863">imag(<span class="var type1" id="S91T15U1202">UZ</span>)</span> ./ ( <span class="mxinfo " id="T2:U865">(<span class="mxinfo " id="T2:U866"><span class="mxinfo " id="T1:U867">2*pi</span>*<span class="var type1" id="S6T2U1211">f</span></span>).^1</span> )</span></span>; <span class="comment">%[m^2/Hz], quadspectrum of vertical displacement and horizontal velocities</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,231" id="srcline231">231</a></span><span class="line"><span class="mxinfo " id="T2:U869"><span class="var type1" id="S99T2U1215">Cxz</span> = <span class="mxinfo " id="T2:U871"><span class="mxinfo " id="T2:U872">real(<span class="var type1" id="S91T15U1219">UZ</span>)</span> ./ ( <span class="mxinfo " id="T2:U874">(<span class="mxinfo " id="T2:U875"><span class="mxinfo " id="T1:U876">2*pi</span>*<span class="var type1" id="S6T2U1228">f</span></span>).^1</span> )</span></span>; <span class="comment">%[m^2/Hz], cospectrum of vertical displacement and horizontal velocities</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,232" id="srcline232">232</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,233" id="srcline233">233</a></span><span class="line"><span class="mxinfo " id="T2:U878"><span class="var type1" id="S100T2U1232">Qyz</span> = <span class="mxinfo " id="T2:U880"><span class="mxinfo " id="T2:U881">imag(<span class="var type1" id="S92T15U1236">VZ</span>)</span> ./ ( <span class="mxinfo " id="T2:U883">(<span class="mxinfo " id="T2:U884"><span class="mxinfo " id="T1:U885">2*pi</span>*<span class="var type1" id="S6T2U1245">f</span></span>).^1</span> )</span></span>; <span class="comment">%[m^2/Hz], quadspectrum of vertical displacement and horizontal velocities</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,234" id="srcline234">234</a></span><span class="line"><span class="mxinfo " id="T2:U887"><span class="var type1" id="S101T2U1249">Cyz</span> = <span class="mxinfo " id="T2:U889"><span class="mxinfo " id="T2:U890">real(<span class="var type1" id="S92T15U1253">VZ</span>)</span> ./ ( <span class="mxinfo " id="T2:U892">(<span class="mxinfo " id="T2:U893"><span class="mxinfo " id="T1:U894">2*pi</span>*<span class="var type1" id="S6T2U1262">f</span></span>).^1</span> )</span></span>; <span class="comment">%[m^2/Hz], cospectrum of vertical displacement and horizontal velocities</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,235" id="srcline235">235</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,236" id="srcline236">236</a></span><span class="line"><span class="mxinfo " id="T2:U896"><span class="var type1" id="S102T2U1266">Cxy</span> = <span class="mxinfo " id="T2:U898"><span class="mxinfo " id="T2:U899">real(<span class="var type1" id="S90T15U1270">UV</span>)</span> ./ ( <span class="mxinfo " id="T2:U901">(<span class="mxinfo " id="T2:U902"><span class="mxinfo " id="T1:U903">2*pi</span>*<span class="var type1" id="S6T2U1279">f</span></span>).^2</span> )</span></span>;  <span class="comment">%[m^2/Hz]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,237" id="srcline237">237</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,238" id="srcline238">238</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,239" id="srcline239">239</a></span><span class="line"><span class="comment">%% wave spectral moments </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,240" id="srcline240">240</a></span><span class="line"><span class="comment">% wave directions from Kuik et al, JPO, 1988 and Herbers et al, JTech, 2012</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,241" id="srcline241">241</a></span><span class="line"><span class="comment">% NOTE THAT THIS USES COSPECTRA OF Z AND U OR V, WHICH DIFFS FROM QUADSPECTRA OF Z AND X OR Y</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,242" id="srcline242">242</a></span><span class="line"><span class="comment">% note also that normalization is skewed by the bias of Exx + Eyy over Ezz</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,243" id="srcline243">243</a></span><span class="line"><span class="comment">% (non-unity check factor)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,244" id="srcline244">244</a></span><span class="line"><span class="mxinfo " id="T2:U905"><span class="var type1" id="S7T2U1283">a1</span> = <span class="mxinfo " id="T2:U907"><span class="var type1" id="S99T2U1285">Cxz</span> ./ <span class="mxinfo " id="T2:U909">sqrt( <span class="mxinfo " id="T2:U910">(<span class="mxinfo " id="T2:U911"><span class="var type1" id="S93T2U1291">Exx</span>+<span class="var type1" id="S94T2U1292">Eyy</span></span>).* <span class="var type1" id="S95T2U1293">Ezz</span></span> )</span></span></span>;  <span class="comment">%[], would use Qxz for actual displacements</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,245" id="srcline245">245</a></span><span class="line"><span class="mxinfo " id="T2:U915"><span class="var type1" id="S8T2U1296">b1</span> = <span class="mxinfo " id="T2:U917"><span class="var type1" id="S101T2U1298">Cyz</span> ./ <span class="mxinfo " id="T2:U919">sqrt( <span class="mxinfo " id="T2:U920">(<span class="mxinfo " id="T2:U921"><span class="var type1" id="S93T2U1304">Exx</span>+<span class="var type1" id="S94T2U1305">Eyy</span></span>).* <span class="var type1" id="S95T2U1306">Ezz</span></span> )</span></span></span>;  <span class="comment">%[], would use Qyz for actual displacements</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,246" id="srcline246">246</a></span><span class="line"><span class="mxinfo " id="T2:U925"><span class="var type1" id="S9T2U1309">a2</span> = <span class="mxinfo " id="T2:U927">(<span class="mxinfo " id="T2:U928"><span class="var type1" id="S93T2U1313">Exx</span> - <span class="var type1" id="S94T2U1314">Eyy</span></span>) ./ (<span class="mxinfo " id="T2:U931"><span class="var type1" id="S93T2U1317">Exx</span> + <span class="var type1" id="S94T2U1318">Eyy</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,247" id="srcline247">247</a></span><span class="line"><span class="mxinfo " id="T2:U934"><span class="var type1" id="S10T2U1321">b2</span> = <span class="mxinfo " id="T2:U936"><span class="mxinfo " id="T2:U937"><span class="mxinfo " id="T1:U938">2</span> .* <span class="var type1" id="S102T2U1325">Cxy</span></span> ./ ( <span class="mxinfo " id="T2:U940"><span class="var type1" id="S93T2U1328">Exx</span> + <span class="var type1" id="S94T2U1329">Eyy</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,248" id="srcline248">248</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,249" id="srcline249">249</a></span><span class="line"><span class="comment">% discount a2 and b2 according to the check factor (non-circular orbits)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,250" id="srcline250">250</a></span><span class="line"><span class="comment">%a2 = check.*a2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,251" id="srcline251">251</a></span><span class="line"><span class="comment">%b2 = check.*b2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,252" id="srcline252">252</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,253" id="srcline253">253</a></span><span class="line"><span class="comment">%% wave directions</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,254" id="srcline254">254</a></span><span class="line"><span class="comment">% note that 0 deg is for waves headed towards positive x (EAST, right hand system)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,255" id="srcline255">255</a></span><span class="line"><span class="mxinfo " id="T2:U943"><span class="var type1" id="S103T2U1332">dir1</span> = <span class="mxinfo " id="T2:U945">atan2(<span class="var type1" id="S8T2U1335">b1</span>,<span class="var type1" id="S7T2U1336">a1</span>)</span></span> ;  <span class="comment">% [rad], 4 quadrant</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,256" id="srcline256">256</a></span><span class="line"><span class="mxinfo " id="T2:U948"><span class="var type1" id="S105T2U1339">dir2</span> = <span class="mxinfo " id="T2:U950"><span class="mxinfo " id="T2:U951">atan2(<span class="var type1" id="S10T2U1343">b2</span>,<span class="var type1" id="S9T2U1344">a2</span>)</span>/2</span></span> ; <span class="comment">% [rad], only 2 quadrant</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,257" id="srcline257">257</a></span><span class="line"><span class="mxinfo " id="T2:U954"><span class="var type1" id="S106T2U1348">spread1</span> = <span class="mxinfo " id="T2:U956">sqrt( <span class="mxinfo " id="T2:U957"><span class="mxinfo " id="T1:U958">2</span> * ( <span class="mxinfo " id="T2:U959"><span class="mxinfo " id="T1:U960">1</span> - <span class="mxinfo " id="T2:U961">sqrt(<span class="mxinfo " id="T2:U962"><span class="mxinfo " id="T2:U963"><span class="var type1" id="S7T2U1360">a1</span>.^2</span> + <span class="mxinfo " id="T2:U965"><span class="var type1" id="S10T2U1363">b2</span>.^2</span></span>)</span></span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,258" id="srcline258">258</a></span><span class="line"><span class="mxinfo " id="T2:U967"><span class="var type1" id="S107T2U1367">spread2</span> = <span class="mxinfo " id="T2:U969">sqrt( <span class="mxinfo " id="T2:U970">abs( <span class="mxinfo " id="T2:U971"><span class="mxinfo " id="T1:U972">0.5</span> - <span class="mxinfo " id="T2:U973"><span class="mxinfo " id="T1:U974">0.5</span> .* ( <span class="mxinfo " id="T2:U975"><span class="mxinfo " id="T2:U976"><span class="var type1" id="S9T2U1379">a2</span>.*<span class="mxinfo " id="T2:U978">cos(<span class="mxinfo " id="T2:U979"><span class="mxinfo " id="T1:U980">2</span>.*<span class="var type1" id="S105T2U1384">dir2</span></span>)</span></span> + <span class="mxinfo " id="T2:U982"><span class="var type1" id="S10T2U1386">b2</span>.*<span class="mxinfo " id="T2:U984">cos(<span class="mxinfo " id="T2:U985"><span class="mxinfo " id="T1:U986">2</span>.*<span class="var type1" id="S105T2U1391">dir2</span></span>)</span></span></span> )</span></span>  )</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,259" id="srcline259">259</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,260" id="srcline260">260</a></span><span class="line"><span class="comment">%% screen for presence/absence of vertical data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,261" id="srcline261">261</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T3:U988"><span class="var type1" id="S24T1U1395">zdummy</span> ==<span class="mxinfo " id="T1:U990">1</span></span>,</span></span>
<span class="srcline"><span class="lineno"><a href="1,262" id="srcline262">262</a></span><span class="line">    <span class="mxinfo " id="T2:U991"><span class="var type1" id="S95T2U1400">Ezz</span>(:) = <span class="mxinfo " id="T1:U993">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,263" id="srcline263">263</a></span><span class="line">    <span class="mxinfo " id="T2:U994"><span class="var type1" id="S7T2U1406">a1</span>(:) = <span class="mxinfo " id="T1:U996">9999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,264" id="srcline264">264</a></span><span class="line">    <span class="mxinfo " id="T2:U997"><span class="var type1" id="S8T2U1412">b1</span>(:) = <span class="mxinfo " id="T1:U999">9999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,265" id="srcline265">265</a></span><span class="line">    <span class="mxinfo " id="T2:U1000"><span class="var type1" id="S103T2U1418">dir1</span>(:) = <span class="mxinfo " id="T1:U1002">9999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,266" id="srcline266">266</a></span><span class="line">    <span class="mxinfo " id="T2:U1003"><span class="var type1" id="S106T2U1424">spread1</span>(:) = <span class="mxinfo " id="T1:U1005">9999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,267" id="srcline267">267</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,268" id="srcline268">268</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,269" id="srcline269">269</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,270" id="srcline270">270</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,271" id="srcline271">271</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,272" id="srcline272">272</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,273" id="srcline273">273</a></span><span class="line"><span class="comment">%% apply LFNR tolerance </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,274" id="srcline274">274</a></span><span class="line"><span class="comment">%Exx(LFNR*(UU) &lt; Exx ) = 0;  % quality control based on LFNR of swell</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,275" id="srcline275">275</a></span><span class="line"><span class="comment">%Eyy(LFNR*(VV) &lt; Eyy ) = 0;  % quality control based on LFNR of swell</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,276" id="srcline276">276</a></span><span class="line"><span class="comment">%Ezz(LFNR*(ZZ) &lt; Ezz ) = 0;  % quality control based on LFNR of swell</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,277" id="srcline277">277</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,278" id="srcline278">278</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,279" id="srcline279">279</a></span><span class="line"><span class="comment">%% Scalar energy spectra (a0)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,280" id="srcline280">280</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,281" id="srcline281">281</a></span><span class="line"><span class="comment">%if zdummy == 1,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,282" id="srcline282">282</a></span><span class="line"><span class="mxinfo " id="T2:U1006"><span class="var type1" id="S5T2U1430">E</span> = <span class="mxinfo " id="T2:U1008"><span class="var type1" id="S93T2U1432">Exx</span> + <span class="var type1" id="S94T2U1433">Eyy</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,283" id="srcline283">283</a></span><span class="line"><span class="comment">%else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,284" id="srcline284">284</a></span><span class="line"><span class="comment">%    E = Ezz;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,285" id="srcline285">285</a></span><span class="line"><span class="comment">%end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,286" id="srcline286">286</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,287" id="srcline287">287</a></span><span class="line"><span class="comment">%E = zeros(1,length(f));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,288" id="srcline288">288</a></span><span class="line"><span class="comment">%if wdummy ==1,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,289" id="srcline289">289</a></span><span class="line"><span class="comment">%    E = Exx + Eyy;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,290" id="srcline290">290</a></span><span class="line"><span class="comment">%else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,291" id="srcline291">291</a></span><span class="line"><span class="comment">%fchange = 0.1; </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,292" id="srcline292">292</a></span><span class="line"><span class="comment">%E(f&gt;fchange) = Exx(f&gt;fchange) +Eyy(f&gt;fchange) ; % use GPS for scalar energy of wind waves</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,293" id="srcline293">293</a></span><span class="line"><span class="comment">%E(f&lt;=fchange) = Ezz(f&lt;=fchange); % use heave acceleratiosn for scalar energy of swell</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,294" id="srcline294">294</a></span><span class="line"><span class="comment">%end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,295" id="srcline295">295</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,296" id="srcline296">296</a></span><span class="line"><span class="comment">% testing bits</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,297" id="srcline297">297</a></span><span class="line"><span class="comment">%E = nanmean([Ezz' (Exx+Eyy)'],2)';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,298" id="srcline298">298</a></span><span class="line"><span class="comment">%E = Eyy+Exx; % pure GPS version (for testing)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,299" id="srcline299">299</a></span><span class="line"><span class="comment">%E( check &gt; maxEratio | check &lt; minEratio ) = 0; </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,300" id="srcline300">300</a></span><span class="line"><span class="comment">%figure, loglog(f,check)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,301" id="srcline301">301</a></span><span class="line"><span class="comment">%clf, loglog(f,UU+VV,'g',f,Exx+Eyy,'b',f,Ezz,'r'),legend('UU+VV','XX+YY','ZZ') % for testing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,302" id="srcline302">302</a></span><span class="line"><span class="comment">%loglog(f,abs(Cxz),f,abs(Cyz))</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,303" id="srcline303">303</a></span><span class="line"><span class="mxinfo " id="T18:U1011"><span class="autoExtrinsicFcn" id="F727N7:B1436">drawnow</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,304" id="srcline304">304</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,305" id="srcline305">305</a></span><span class="line"><span class="comment">%% wave stats</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,306" id="srcline306">306</a></span><span class="line"><span class="mxinfo " id="T4:U1012"><span class="var type1" id="S110T4U1439">fwaves</span> = <span class="mxinfo " id="T4:U1014"><span class="mxinfo " id="T4:U1015"><span class="var type1" id="S6T2U1442">f</span>&gt;<span class="mxinfo " id="T1:U1017">0.05</span></span> &amp; <span class="mxinfo " id="T4:U1018"><span class="var type1" id="S6T2U1445">f</span>&lt;<span class="mxinfo " id="T1:U1020">1</span></span></span></span>; <span class="comment">% frequency cutoff for wave stats, 0.4 is specific to SWIFT hull</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,307" id="srcline307">307</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,308" id="srcline308">308</a></span><span class="line"><span class="mxinfo " id="T2:U1021"><span class="mxinfo " id="T2:U1022"><span class="var type1" id="S5T2U1450">E</span>( <span class="mxinfo " id="T4:U1024">~<span class="var type1" id="S110T4U1452">fwaves</span></span> )</span> = <span class="mxinfo " id="T1:U1026">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,309" id="srcline309">309</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,310" id="srcline310">310</a></span><span class="line"><span class="comment">% significant wave height</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,311" id="srcline311">311</a></span><span class="line"><span class="mxinfo " id="T1:U1027"><span class="var type1" id="S2T1U1456">Hs</span>  = <span class="mxinfo " id="T1:U1029"><span class="mxinfo " id="T1:U1030">4</span>*<span class="mxinfo " id="T1:U1031">sqrt( <span class="mxinfo " id="T1:U1032"><span class="mxinfo " id="T1:U1033">sum( <span class="mxinfo " id="T2:U1034"><span class="var type1" id="S5T2U1465">E</span>(<span class="var type1" id="S110T4U1466">fwaves</span>)</span> )</span> * <span class="var type1" id="S86T1U1467">bandwidth</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,312" id="srcline312">312</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,313" id="srcline313">313</a></span><span class="line"><span class="comment">%  energy period</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,314" id="srcline314">314</a></span><span class="line"><span class="mxinfo " id="T1:U1038"><span class="var type1" id="S111T1U1470">fe</span> = <span class="mxinfo " id="T1:U1040"><span class="mxinfo " id="T1:U1041">sum( <span class="mxinfo " id="T2:U1042"><span class="mxinfo " id="T2:U1043"><span class="var type1" id="S6T2U1476">f</span>(<span class="var type1" id="S110T4U1477">fwaves</span>)</span>.*<span class="mxinfo " id="T2:U1046"><span class="var type1" id="S5T2U1479">E</span>(<span class="var type1" id="S110T4U1480">fwaves</span>)</span></span> )</span>./<span class="mxinfo " id="T1:U1049">sum( <span class="mxinfo " id="T2:U1050"><span class="var type1" id="S5T2U1484">E</span>(<span class="var type1" id="S110T4U1485">fwaves</span>)</span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,315" id="srcline315">315</a></span><span class="line">[<span class="mxinfo " id="T1:U1053">~</span> , <span class="var type1" id="S112T1U1490">feindex</span>] = min(<span class="mxinfo " id="T2:U1055">abs(<span class="mxinfo " id="T2:U1056"><span class="var type1" id="S6T2U1496">f</span>-<span class="var type1" id="S111T1U1497">fe</span></span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,316" id="srcline316">316</a></span><span class="line"><span class="mxinfo " id="T1:U1059"><span class="var type1" id="S114T1U1500">Ta</span> = <span class="mxinfo " id="T1:U1061"><span class="mxinfo " id="T1:U1062">1</span>./<span class="var type1" id="S111T1U1503">fe</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,317" id="srcline317">317</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,318" id="srcline318">318</a></span><span class="line"><span class="comment">% peak period</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,319" id="srcline319">319</a></span><span class="line">[<span class="mxinfo " id="T1:U1064">~</span> , <span class="var type1" id="S115T1U1508">fpindex</span>] = max(<span class="mxinfo " id="T2:U1066"><span class="var type1" id="S87T2U1512">UU</span>+<span class="var type1" id="S88T2U1513">VV</span></span>); <span class="comment">% can use velocity (picks out more distint peak)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,320" id="srcline320">320</a></span><span class="line"><span class="comment">%[~ , fpindex] = max(E);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,321" id="srcline321">321</a></span><span class="line"><span class="mxinfo " id="T1:U1069"><span class="var type1" id="S3T1U1516">Tp</span> = <span class="mxinfo " id="T1:U1071"><span class="mxinfo " id="T1:U1072">1</span>./<span class="mxinfo " id="T1:U1073"><span class="var type1" id="S6T2U1520">f</span>(<span class="var type1" id="S115T1U1521">fpindex</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,322" id="srcline322">322</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,323" id="srcline323">323</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T3:U1076"><span class="var type1" id="S3T1U1525">Tp</span> &gt; <span class="mxinfo " id="T1:U1078">20</span></span>, <span class="comment">% if peak not found, use centroid</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,324" id="srcline324">324</a></span><span class="line">    <span class="mxinfo " id="T1:U1079"><span class="var type1" id="S3T1U1529">Tp</span> = <span class="var type1" id="S114T1U1530">Ta</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,325" id="srcline325">325</a></span><span class="line">    <span class="mxinfo " id="T1:U1082"><span class="var type1" id="S115T1U1533">fpindex</span> = <span class="var type1" id="S112T1U1534">feindex</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,326" id="srcline326">326</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,327" id="srcline327">327</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,328" id="srcline328">328</a></span><span class="line"><span class="comment">%% spectral directions</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,329" id="srcline329">329</a></span><span class="line"><span class="mxinfo " id="T2:U1085"><span class="var type1" id="S117T2U1537">dir</span> = <span class="mxinfo " id="T2:U1087"><span class="mxinfo " id="T1:U1088">- 180 ./ 3.14</span> * <span class="var type1" id="S103T2U1543">dir1</span></span></span>;  <span class="comment">% switch from rad to deg, and CCz to Cz (negate)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,330" id="srcline330">330</a></span><span class="line"><span class="mxinfo " id="T2:U1090"><span class="var type1" id="S117T2U1546">dir</span> = <span class="mxinfo " id="T2:U1092"><span class="var type1" id="S117T2U1548">dir</span> + <span class="mxinfo " id="T1:U1094">90</span></span></span>;  <span class="comment">% rotate from eastward = 0 to northward  = 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,331" id="srcline331">331</a></span><span class="line"><span class="mxinfo " id="T2:U1095"><span class="mxinfo " id="T2:U1096"><span class="var type1" id="S117T2U1553">dir</span>( <span class="mxinfo " id="T4:U1098"><span class="var type1" id="S117T2U1555">dir</span> &lt; <span class="mxinfo " id="T1:U1100">0</span></span> )</span> = <span class="mxinfo " id="T2:U1101"><span class="mxinfo " id="T2:U1102"><span class="var type1" id="S117T2U1559">dir</span>( <span class="mxinfo " id="T4:U1104"><span class="var type1" id="S117T2U1561">dir</span> &lt; <span class="mxinfo " id="T1:U1106">0</span></span> )</span> + <span class="mxinfo " id="T1:U1107">360</span></span></span>;  <span class="comment">% take Nz quadrant from negative to 270-360 range</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,332" id="srcline332">332</a></span><span class="line"><span class="mxinfo " id="T4:U1108"><span class="var type1" id="S118T4U1566">westdirs</span> = <span class="mxinfo " id="T4:U1110"><span class="var type1" id="S117T2U1568">dir</span> &gt; <span class="mxinfo " id="T1:U1112">180</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,333" id="srcline333">333</a></span><span class="line"><span class="mxinfo " id="T4:U1113"><span class="var type1" id="S119T4U1572">eastdirs</span> = <span class="mxinfo " id="T4:U1115"><span class="var type1" id="S117T2U1574">dir</span> &lt; <span class="mxinfo " id="T1:U1117">180</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,334" id="srcline334">334</a></span><span class="line"><span class="mxinfo " id="T2:U1118"><span class="mxinfo " id="T2:U1119"><span class="var type1" id="S117T2U1579">dir</span>( <span class="var type1" id="S118T4U1580">westdirs</span> )</span> = <span class="mxinfo " id="T2:U1122"><span class="mxinfo " id="T2:U1123"><span class="var type1" id="S117T2U1583">dir</span> ( <span class="var type1" id="S118T4U1584">westdirs</span> )</span> - <span class="mxinfo " id="T1:U1126">180</span></span></span>; <span class="comment">% take reciprocal such wave direction is FROM, not TOWARDS</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,335" id="srcline335">335</a></span><span class="line"><span class="mxinfo " id="T2:U1127"><span class="mxinfo " id="T2:U1128"><span class="var type1" id="S117T2U1589">dir</span>( <span class="var type1" id="S119T4U1590">eastdirs</span> )</span> = <span class="mxinfo " id="T2:U1131"><span class="mxinfo " id="T2:U1132"><span class="var type1" id="S117T2U1593">dir</span> ( <span class="var type1" id="S119T4U1594">eastdirs</span> )</span> + <span class="mxinfo " id="T1:U1135">180</span></span></span>; <span class="comment">% take reciprocal such wave direction is FROM, not TOWARDS</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,336" id="srcline336">336</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,337" id="srcline337">337</a></span><span class="line"><span class="comment">% directional spread</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,338" id="srcline338">338</a></span><span class="line"><span class="mxinfo " id="T2:U1136"><span class="var type1" id="S120T2U1598">spread</span> = <span class="mxinfo " id="T2:U1138"><span class="mxinfo " id="T1:U1139"><span class="mxinfo " id="T1:U1140">180</span> ./ <span class="mxinfo " id="T1:U1141">3.14</span></span> .* <span class="var type1" id="S106T2U1603">spread1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,339" id="srcline339">339</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,340" id="srcline340">340</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,341" id="srcline341">341</a></span><span class="line"><span class="comment">%% dominant direction</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,342" id="srcline342">342</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,343" id="srcline343">343</a></span><span class="line"><span class="comment">% or peak direction (very noisy)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,344" id="srcline344">344</a></span><span class="line"><span class="comment">%Dp = dir(fpindex); % dominant (peak) direction, use peak f</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,345" id="srcline345">345</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,346" id="srcline346">346</a></span><span class="line"><span class="comment">% or average</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,347" id="srcline347">347</a></span><span class="line"><span class="mxinfo " id="T1:U1143"><span class="var type1" id="S4T1U1606">Dp</span> = <span class="mxinfo " id="T1:U1145"><span class="var type1" id="S117T2U1608">dir</span>(<span class="var type1" id="S115T1U1609">fpindex</span>)</span></span>; <span class="comment">% dominant (peak) direction, use peak f</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,348" id="srcline348">348</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,349" id="srcline349">349</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T3:U1148"><span class="var type1" id="S24T1U1613">zdummy</span> == <span class="mxinfo " id="T1:U1150">1</span></span>,</span></span>
<span class="srcline"><span class="lineno"><a href="1,350" id="srcline350">350</a></span><span class="line">    <span class="mxinfo " id="T1:U1151"><span class="var type1" id="S4T1U1617">Dp</span> = <span class="mxinfo " id="T1:U1153">9999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,351" id="srcline351">351</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,352" id="srcline352">352</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,353" id="srcline353">353</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,354" id="srcline354">354</a></span><span class="line"><span class="comment">%% screen for bad direction estimate, or no heave data    </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,355" id="srcline355">355</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,356" id="srcline356">356</a></span><span class="line"><span class="comment">% inds = fpindex + [-1:1]; % pick neighboring bands</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,357" id="srcline357">357</a></span><span class="line"><span class="comment">% if all(inds&gt;0) &amp; all(inds&lt;42), </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,358" id="srcline358">358</a></span><span class="line"><span class="comment">%     </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,359" id="srcline359">359</a></span><span class="line"><span class="comment">%   dirnoise = std( dir(inds) );</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,360" id="srcline360">360</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,361" id="srcline361">361</a></span><span class="line"><span class="comment">%   if dirnoise &gt; 45  |  zdummy == 1,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,362" id="srcline362">362</a></span><span class="line"><span class="comment">%       Dp = 9999;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,363" id="srcline363">363</a></span><span class="line"><span class="comment">%   else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,364" id="srcline364">364</a></span><span class="line"><span class="comment">%       Dp = Dp;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,365" id="srcline365">365</a></span><span class="line"><span class="comment">%   end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,366" id="srcline366">366</a></span><span class="line"><span class="comment">%   </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,367" id="srcline367">367</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,368" id="srcline368">368</a></span><span class="line"><span class="comment">%     Dp =9999;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,369" id="srcline369">369</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,370" id="srcline370">370</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,371" id="srcline371">371</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,372" id="srcline372">372</a></span><span class="line"><span class="comment">%% prune high frequency results</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,373" id="srcline373">373</a></span><span class="line"><span class="mxinfo " id="T2:U1154"><span class="var type1" id="S5T2U1623">E</span>( <span class="mxinfo " id="T4:U1156"><span class="var type1" id="S6T2U1625">f</span> &gt; <span class="var type1" id="S20T1U1626">maxf</span></span> ) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,374" id="srcline374">374</a></span><span class="line"><span class="mxinfo " id="T2:U1159"><span class="var type1" id="S95T2U1632">Ezz</span>( <span class="mxinfo " id="T4:U1161"><span class="var type1" id="S6T2U1634">f</span> &gt; <span class="var type1" id="S20T1U1635">maxf</span></span> ) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,375" id="srcline375">375</a></span><span class="line"><span class="mxinfo " id="T2:U1164"><span class="var type1" id="S117T2U1641">dir</span>( <span class="mxinfo " id="T4:U1166"><span class="var type1" id="S6T2U1643">f</span> &gt; <span class="var type1" id="S20T1U1644">maxf</span></span> ) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,376" id="srcline376">376</a></span><span class="line"><span class="mxinfo " id="T2:U1169"><span class="var type1" id="S120T2U1650">spread</span>( <span class="mxinfo " id="T4:U1171"><span class="var type1" id="S6T2U1652">f</span> &gt; <span class="var type1" id="S20T1U1653">maxf</span></span> ) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,377" id="srcline377">377</a></span><span class="line"><span class="mxinfo " id="T2:U1174"><span class="var type1" id="S7T2U1659">a1</span>( <span class="mxinfo " id="T4:U1176"><span class="var type1" id="S6T2U1661">f</span> &gt; <span class="var type1" id="S20T1U1662">maxf</span></span> ) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,378" id="srcline378">378</a></span><span class="line"><span class="mxinfo " id="T2:U1179"><span class="var type1" id="S8T2U1668">b1</span>( <span class="mxinfo " id="T4:U1181"><span class="var type1" id="S6T2U1670">f</span> &gt; <span class="var type1" id="S20T1U1671">maxf</span></span> ) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,379" id="srcline379">379</a></span><span class="line"><span class="mxinfo " id="T2:U1184"><span class="var type1" id="S9T2U1677">a2</span>( <span class="mxinfo " id="T4:U1186"><span class="var type1" id="S6T2U1679">f</span> &gt; <span class="var type1" id="S20T1U1680">maxf</span></span> ) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,380" id="srcline380">380</a></span><span class="line"><span class="mxinfo " id="T2:U1189"><span class="var type1" id="S10T2U1686">b2</span>( <span class="mxinfo " id="T4:U1191"><span class="var type1" id="S6T2U1688">f</span> &gt; <span class="var type1" id="S20T1U1689">maxf</span></span> ) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,381" id="srcline381">381</a></span><span class="line"><span class="mxinfo " id="T2:U1194"><span class="var type1" id="S96T2U1695">check</span>( <span class="mxinfo " id="T4:U1196"><span class="var type1" id="S6T2U1697">f</span> &gt; <span class="var type1" id="S20T1U1698">maxf</span></span> ) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,382" id="srcline382">382</a></span><span class="line"><span class="mxinfo " id="T2:U1199"><span class="var type1" id="S6T2U1704">f</span>( <span class="mxinfo " id="T4:U1201"><span class="var type1" id="S6T2U1706">f</span> &gt; <span class="var type1" id="S20T1U1707">maxf</span></span> ) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,383" id="srcline383">383</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,384" id="srcline384">384</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,385" id="srcline385">385</a></span><span class="line"><span class="keyword">else</span> <span class="comment">% if not enough points or sufficent sampling rate or data, give 9999</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,386" id="srcline386">386</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,387" id="srcline387">387</a></span><span class="line">     <span class="mxinfo " id="T1:U1204"><span class="var type1" id="S2T1U1713">Hs</span> = <span class="mxinfo " id="T1:U1206">9999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,388" id="srcline388">388</a></span><span class="line">     <span class="mxinfo " id="T1:U1207"><span class="var type1" id="S3T1U1717">Tp</span> = <span class="mxinfo " id="T1:U1209">9999</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,389" id="srcline389">389</a></span><span class="line">     <span class="mxinfo " id="T1:U1210"><span class="var type1" id="S4T1U1721">Dp</span> = <span class="mxinfo " id="T1:U1212">9999</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,390" id="srcline390">390</a></span><span class="line">     <span class="mxinfo " id="T2:U1213"><span class="var type1" id="S5T2U1725">E</span> = <span class="mxinfo " id="T1:U1215">9999</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,391" id="srcline391">391</a></span><span class="line">     <span class="mxinfo " id="T2:U1216"><span class="var type1" id="S6T2U1729">f</span> = <span class="mxinfo " id="T1:U1218">9999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,392" id="srcline392">392</a></span><span class="line">     <span class="mxinfo " id="T2:U1219"><span class="var type1" id="S7T2U1733">a1</span> = <span class="mxinfo " id="T1:U1221">9999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,393" id="srcline393">393</a></span><span class="line">     <span class="mxinfo " id="T2:U1222"><span class="var type1" id="S8T2U1737">b1</span> = <span class="mxinfo " id="T1:U1224">9999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,394" id="srcline394">394</a></span><span class="line">     <span class="mxinfo " id="T2:U1225"><span class="var type1" id="S9T2U1741">a2</span> = <span class="mxinfo " id="T1:U1227">9999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,395" id="srcline395">395</a></span><span class="line">     <span class="mxinfo " id="T2:U1228"><span class="var type1" id="S10T2U1745">b2</span> = <span class="mxinfo " id="T1:U1230">9999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,396" id="srcline396">396</a></span><span class="line">     <span class="mxinfo " id="T1:U1231"><span class="var type1" id="S96T1U1749">check</span> = <span class="mxinfo " id="T1:U1233">9999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,397" id="srcline397">397</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,398" id="srcline398">398</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,399" id="srcline399">399</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,400" id="srcline400">400</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,401" id="srcline401">401</a></span><span class="line"><span class="comment">% quality control</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,402" id="srcline402">402</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T3:U1234"><span class="var type1" id="S3T1U1754">Tp</span>&gt;<span class="mxinfo " id="T1:U1236">20</span></span>,   </span></span>
<span class="srcline"><span class="lineno"><a href="1,403" id="srcline403">403</a></span><span class="line">     <span class="mxinfo " id="T1:U1237"><span class="var type1" id="S2T1U1758">Hs</span> = <span class="mxinfo " id="T1:U1239">9999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,404" id="srcline404">404</a></span><span class="line">     <span class="mxinfo " id="T1:U1240"><span class="var type1" id="S3T1U1762">Tp</span> = <span class="mxinfo " id="T1:U1242">9999</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,405" id="srcline405">405</a></span><span class="line">     <span class="mxinfo " id="T1:U1243"><span class="var type1" id="S4T1U1766">Dp</span> = <span class="mxinfo " id="T1:U1245">9999</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,406" id="srcline406">406</a></span><span class="line"><span class="keyword">else</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,407" id="srcline407">407</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,408" id="srcline408">408</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,409" id="srcline409">409</a></span><span class="line"></span></span>
</pre>
</body>
</html>
